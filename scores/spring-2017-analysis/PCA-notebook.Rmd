---
title: "R Notebook"
output: html_notebook
---

# Principle Component Analysis in R 

```{r}
# Loading required package: psych
require(psych)

# Loading required package: GPArotation
require(GPArotation)

library(lattice)
url <- "/Users/jialincheoh/Desktop/survey_final_read.csv"
survey <- read.csv(url, header=TRUE)
survey
```

```{r}
names(survey)[1:13] <- c("monetary_compensation", "excellent_programmer", "internship", 
                         "introduce_ideas", "get_in_touch", "known_creativity", "improve_skills", 
                         "test_capability", "enjoy_problems", "keep_up", "dissatisfaction", "curious", "pass_class")
survey
```

```{r}
# Extract all 13 survey items with motivation construct
motivation <- survey[c(1:13)]
motivation
```


```{r}
lowerCor(motivation)
```
```{r}
library(correlation)

correlation::correlation(motivation,
                         include_factors = TRUE, method = "auto"
)
```

```{r}
# Do the PCA with singular value decomposition of the (centered and possibly scaled) data matrix

my.prc = prcomp(motivation, center=TRUE, scale=TRUE)
screeplot(my.prc, main="Scree Plot", xlab="Components")
screeplot(my.prc, main="Scree Plot", type="line" )

```



```{r}
my.prc
```

```{r}
# Kaiser criterion to determine the number of principle components to keep 
my.prc$sdev ^ 2
```


```{r}
# DotPlot PC1

load    <- my.prc$rotation
sorted.loadings <- load[order(load[, 1]), 1]
myTitle <- "Loadings Plot for PC1" 
myXlab  <- "Variable Loadings"
dotplot(sorted.loadings, main=myTitle, xlab=myXlab, cex=1.5, col="red")
summary(my.prc)
```

```{r}
# DotPlot PC2

sorted.loadings <- load[order(load[, 2]), 2]
myTitle <- "Loadings Plot for PC2"
myXlab  <- "Variable Loadings"
dotplot(sorted.loadings, main=myTitle, xlab=myXlab, cex=1.5, col="red")
```
```{r}
# Now draw the BiPlot
biplot(my.prc, cex=c(1, 0.7))
```
```{r}
my.prc$rotation[, 1:2]
```
```{r}
options(max.print=1000000)
project.b = predict(my.prc, motivation)
project.b
```

## Done varimax rotation on 6 components.


```{r}
# Apply the Varimax Rotation
my.var <- varimax(my.prc$rotation[, 1:6])

my.var
```
## Interpretation: 

> Assume threshold 0.5 

> PC1 - Gain Knowledge and Intrinsic Innovation Interest ( only missed enjoy_problems )
> PC2 - Dissatisfaction 
> PC3 - Monetary rewards 
> PC4 - Curious 
> PC5 - Get known for excellent programmer / excellent creativity 
> PC6 - Show Ideas


```{r}
# Apply the Varimax Rotation
my.var <- varimax(my.prc$rotation[, 1:2])

my.var
```

```{r}
# Apply the Varimax Rotation
my.var <- varimax(my.prc$rotation[, 1:3])

my.var
```
```{r}
head(my.prc$x)
```

```{r}
summary(my.prc)
```

## Get the PCA scores for 163 participants 

```{r}
pca <- predict(my.prc, newdata=motivation)
pca
```


```{r}
print(my.prc)
```
```{r}
summary(motivation)
```



```{r}
head(my.prc$x)
```

```{r}
pca_frame <- as.data.frame(pca)
pca_frame
```



```{r}
allData <- cbind(pca_frame[1], id = survey$hack_id)
allData
```
```{r}
allData_abs_PC1 <- abs(allData)
allData_abs_PC1
```
```{r}
anova_1 <- as.data.frame(allData_abs_PC1)
anova_1
```

```{r}
ANOVA_RESULTS_1 <- aov(PC1 ~ id, data=anova_1)
summary(ANOVA_RESULTS_1)
```

## Interpretation

> No difference between all 4 groups for PC1 


```{r}
allData_abs_PC1$performance <- ifelse(allData_abs_PC1$id==1, 1,
        ifelse(allData_abs_PC1$id==2, 0,
        ifelse(allData_abs_PC1$id==0, 0,
        ifelse(allData_abs_PC1$id==3, 1, NA))))

allData_abs_PC1
```


```{r}
allData_abs_PC1$solution <- ifelse(allData_abs_PC1$id==1, 0,
        ifelse(allData_abs_PC1$id==2, 1,
        ifelse(allData_abs_PC1$id==0, 0,
        ifelse(allData_abs_PC1$id==3, 1, NA))))

allData_abs_PC1
```
.

```{r}
res <- t.test(PC1 ~ performance, data = allData_abs_PC1, var.equal = TRUE)
res
```
## Interpretation: 

> No difference between the two performance groups for PC1


```{r}
res <- t.test(PC1 ~ solution, data = allData_abs_PC1, var.equal = TRUE)
res
```

## Interpretation: 

> No difference between the two solution groups for PC1

```{r}
allData_PC2 <- cbind(pca_frame[2], id = survey$hack_id)
allData_PC2
```

```{r}
allData_abs_PC2 <- abs(allData_PC2)
allData_abs_PC2
```
 
```{r}
anova_2 <- as.data.frame(allData_abs_PC2)
anova_2
```
 
```{r}
ANOVA_RESULTS_2 <- aov(PC2 ~ id, data=anova_2)
summary(ANOVA_RESULTS_2)
```

## Interpretation: 

> No difference between the 4 groups for PC2 

```{r}
allData_abs_PC2$performance <- ifelse(allData_abs_PC2$id==1, 1,
        ifelse(allData_abs_PC2$id==2, 0,
        ifelse(allData_abs_PC2$id==0, 0,
        ifelse(allData_abs_PC2$id==3, 1, NA))))

allData_abs_PC2
```

 
```{r}
allData_abs_PC2$solution <- ifelse(allData_abs_PC2$id==1, 0,
        ifelse(allData_abs_PC2$id==2, 1,
        ifelse(allData_abs_PC2$id==0, 0,
        ifelse(allData_abs_PC2$id==3, 1, NA))))

allData_abs_PC2
```
 


## We’ll use F-test to test for homogeneity in variances
 
```{r}
res.ftest <- var.test(PC2 ~ performance, data = allData_abs_PC2)
res.ftest
```

## Interpretation: 

> The p-value of F-test is p = 0.3605. It’s greater than the significance level alpha = 0.05. In conclusion, there is no significant difference between the variances of the two sets of data. Therefore, we can use the classic t-test witch assume equality of the two variances.

```{r}
res <- t.test(PC2 ~ performance, data = allData_abs_PC2, var.equal = TRUE)
res
```
 
## Interpretation: 
 
 > The p-value of the test is 0.476, which is more than the significance level alpha = 0.05. We can conclude that the types of performance groups are NOT significantly different from each other. 
 
## We’ll use F-test to test for homogeneity in variances. 
 
```{r}
res.ftest <- var.test(PC2 ~ solution, data = allData_abs_PC2)
res.ftest
```
 
## Interpretation:

> The p-value of F-test is p = 0.4073. It’s greater than the significance level alpha = 0.05. In conclusion, there is no significant difference between the variances of the two sets of data. Therefore, we can use the classic t-test witch assume equality of the two variances.

```{r}
res <- t.test(PC2 ~ solution, data = allData_abs_PC2, var.equal = TRUE)
res
```
 
## Interpretation: 

> The p-value of the test is 0.8846, which is greater than the significance level alpha = 0.05. We can conclude that the types of solution groups are NOT significantly different from each other. 

## PCA with princomp method in R 

> The princomp( ) function produces an unrotated principal component analysis.

```{r}

## Perform the Principle Component Analysis 
## cor=TRUE means using correlation matrix instead of the covariance matrix 
## scores=TRUE takes the data and transform into the reduced space/transformed space so that we can work on the data there
princomp_output <- princomp(motivation, scores=TRUE, cor=TRUE)
summary(princomp_output)

```
 
```{r}
## Print the scree plot 

plot(princomp_output)
```


```{r}
summary(princomp_output)
```

```{r}
plot(princomp_output,type="lines")
```

# Unrotated components with 6 factors

```{r}
princomp_output$loadings[, 1:6]
```
 
 
```{r}
princomp_output$loadings
```
 
```{r}
biplot(princomp_output)
```
```{r}
## Print the scores (projections)
## rotated or transformed dataset
fit_unrotated_matrix <- princomp_output$scores[, 1:6]
fit_unrotated_matrix
```
  
> The principal( ) function in the psych package can be used to extract and rotate principal components.

> rotate can "none", "varimax", "quatimax", "promax", "oblimin", "simplimax", or "cluster"


  
```{r}
# Varimax Rotated Principal Components
# retaining 5 components
library(psych)
fit_rotated <- principal(motivation, nfactors=6, rotate="varimax")
fit_rotated # print results
```
 

```{r}
fit_rotated_matrix <- fit_rotated$scores[, 1:6]
fit_rotated_matrix
```

### Make unrotated pca matrix as data frame 
 
```{r}
fit_unrotated_df <- as.data.frame(fit_unrotated_matrix)
fit_unrotated_df
```

### Make rotated pca matrix as data frame 

```{r}
fit_rotated_df <- as.data.frame(fit_rotated_matrix)
fit_rotated_df
```

### Merge hack_id with unrotated pca data frame 

```{r}
unrotated <- cbind(fit_unrotated_df, id = survey$hack_id)
unrotated
```

```{r}
### Merge hack_id with rotated pca data frame 
rotated <- cbind(fit_rotated_df, id = survey$hack_id)
rotated
```
 
### Make all unrotated and rotated PCs in absolute value 

```{r}
rotated_abs <- abs(rotated)
rotated_abs

```

```{r}
unrotated_abs <- abs(unrotated)
unrotated_abs
```

### ANOVA results across all 4 groups for the 6 unrotated PCA components 

```{r}
unrotated_1 <- aov(Comp.1 ~ id, data=unrotated_abs)
summary(unrotated_1)
```

```{r}
unrotated_2 <- aov(Comp.2 ~ id, data=unrotated_abs)
summary(unrotated_2)
```

```{r}
unrotated_3 <- aov(Comp.3 ~ id, data=unrotated_abs)
summary(unrotated_3)
```

```{r}
unrotated_4 <- aov(Comp.4 ~ id, data=unrotated_abs)
summary(unrotated_4)
```

```{r}
unrotated_5 <- aov(Comp.5 ~ id, data=unrotated_abs)
summary(unrotated_5)
```

```{r}
unrotated_6 <- aov(Comp.6 ~ id, data=unrotated_abs)
summary(unrotated_6)
```

## Interpretation: 

> No significance for the unrotated PCA across all the 4 groups. 


### ANOVA results across all 4 groups for the 6 rotated PCA components 

```{r}
rotated_1 <- aov(RC1 ~ id, data=rotated_abs)
summary(rotated_1)
```


```{r}
rotated_2 <- aov(RC2 ~ id, data=rotated_abs)
summary(rotated_2)
```

```{r}
rotated_3 <- aov(RC3 ~ id, data=rotated_abs)
summary(rotated_3)
```

```{r}
rotated_4 <- aov(RC4 ~ id, data=rotated_abs)
summary(rotated_4)
```

```{r}
rotated_5 <- aov(RC5 ~ id, data=rotated_abs)
summary(rotated_5)
```

```{r}
rotated_6 <- aov(RC6 ~ id, data=rotated_abs)
summary(rotated_6)
```

## Interpretation: 

> No significance for the rotated PCA across all the 4 groups. 

## Bind recoded performance and solution groups to unrotated PCA results

```{r}
unrotated_abs$performance <- ifelse(unrotated_abs$id==1, 1,
        ifelse(unrotated_abs$id==2, 0,
        ifelse(unrotated_abs$id==0, 0,
        ifelse(unrotated_abs$id==3, 1, NA))))

unrotated_abs
```

```{r}
unrotated_abs$solution <- ifelse(unrotated_abs$id==1, 0,
        ifelse(unrotated_abs$id==2, 1,
        ifelse(unrotated_abs$id==0, 0,
        ifelse(unrotated_abs$id==3, 1, NA))))

unrotated_abs
```

## Bind recoded performance and solution groups to rotated PCA results

```{r}


rotated_abs$performance <- ifelse(rotated_abs$id==1, 1,
        ifelse(rotated_abs$id==2, 0,
        ifelse(rotated_abs$id==0, 0,
        ifelse(rotated_abs$id==3, 1, NA))))

rotated_abs
```

```{r}
rotated_abs$solution <- ifelse(rotated_abs$id==1, 0,
        ifelse(rotated_abs$id==2, 1,
        ifelse(rotated_abs$id==0, 0,
        ifelse(rotated_abs$id==3, 1, NA))))

rotated_abs
```


## Unpaired t-test can be performed as follow on Unrotated PCs Performance Groups:

> An unpaired t-test (also known as an independent t-test) is a statistical procedure that compares the averages/means of two independent or unrelated groups to determine if there is a significant difference between the two.

```{r}
res<-t.test(unrotated_abs$performance, unrotated_abs$Comp.1 )
res
```

## Interpretation: 

> Difference is significant 

```{r}
res<-t.test(unrotated_abs$performance, unrotated_abs$Comp.2 )
res
```
## Interpretation: 

> Difference is significant 

```{r}
## Interpretation: 

res<-t.test(unrotated_abs$performance, unrotated_abs$Comp.3 )
res
```
## Interpretation: 

> Difference is significant 

```{r}
res<-t.test(unrotated_abs$performance, unrotated_abs$Comp.4 )
res
```

## Interpretation: 

> Difference is significant 

```{r}
res<-t.test(unrotated_abs$performance, unrotated_abs$Comp.5 )
res
```
## Interpretation: 

> Difference is significant 

```{r}
## Interpretation: 

res<-t.test(unrotated_abs$performance, unrotated_abs$Comp.6 )
res
```
## Interpretation: 

> Difference is NOT significant 


## Unpaired t-test can be performed as follow on Unrotated PCs Solution Groups:

```{r}
res<-t.test(unrotated_abs$solution, unrotated_abs$Comp.1 )
res
```
## Interpretation: 

> Difference is significant 

```{r}
res<-t.test(unrotated_abs$solution, unrotated_abs$Comp.2 )
res
```
## Interpretation: 

> Difference is  significant 

```{r}
res<-t.test(unrotated_abs$solution, unrotated_abs$Comp.3 )
res
```

## Interpretation: 

> Difference is  significant 

```{r}
res<-t.test(unrotated_abs$solution, unrotated_abs$Comp.4 )
res
```

## Interpretation: 

> Difference is significant 

```{r}
res<-t.test(unrotated_abs$solution, unrotated_abs$Comp.5 )
res
```


## Interpretation: 

> Difference is significant 



```{r}
res<-t.test(unrotated_abs$solution, unrotated_abs$Comp.6 )
res
```


## Interpretation: 

> Difference is NOT significant 


## Unpaired t-test can be performed as follow on Rotated PCs Performance Groups:

```{r}
res<-t.test(rotated_abs$performance, rotated_abs$RC1 )
res
```

## Interpretation: 

> Difference is significant 

```{r}
res<-t.test(rotated_abs$performance, rotated_abs$RC2 )
res
```

## Interpretation: 

> Difference is significant 

```{r}
res<-t.test(rotated_abs$performance, rotated_abs$RC3 )
res
```

## Interpretation: 

> Difference is significant 

```{r}
res<-t.test(rotated_abs$performance, rotated_abs$RC4 )
res
```

## Interpretation: 

> Difference is significant 

```{r}
res<-t.test(rotated_abs$performance, rotated_abs$RC5 )
res
```

## Interpretation: 

> Difference is significant 


```{r}
res<-t.test(rotated_abs$performance, rotated_abs$RC6 )
res
```

## Interpretation: 

> Difference is significant 

## Unpaired t-test can be performed as follow on Rotated PCs Solution Groups:

```{r}

res<-t.test(rotated_abs$solution, rotated_abs$RC1 )
res

```


## Interpretation: 

> Difference is significant 


```{r}
res<-t.test(rotated_abs$solution, rotated_abs$RC2 )
res
```


## Interpretation: 

> Difference is significant 


```{r}
res<-t.test(rotated_abs$solution, rotated_abs$RC3 )
res
```


## Interpretation: 

> Difference is significant 


```{r}
res<-t.test(rotated_abs$solution, rotated_abs$RC4 )
res
```


## Interpretation: 

> Difference is significant 

```{r}
res<-t.test(rotated_abs$solution, rotated_abs$RC5 )
res
```


## Interpretation: 

> Difference is significant 

```{r}
res<-t.test(rotated_abs$solution, rotated_abs$RC6 )
res
```
## Interpretation: 

> Difference is significant 

```{r}
## Validation on each bogota group
motivation_hackid <- cbind(motivation, id = survey$hack_id)
motivation_hackid
```
```{r}
survey_bogota_0 <- subset(motivation_hackid, id == 0)
survey_bogota_0
```

```{r}
princomp_bogota_0 <- princomp(survey_bogota_0[1:13], scores=TRUE, cor=TRUE)
summary(princomp_output)

```
```{r}
# Unrotated components with 6 factors
princomp_bogota_0$loadings[, 1:6]

```

```{r}
biplot(princomp_bogota_0)

```
```{r}
survey_bogota_1 <- subset(motivation_hackid, id == 1)
survey_bogota_1
```
```{r}
princomp_bogota_1 <- princomp(survey_bogota_1[1:13], scores=TRUE, cor=TRUE)
summary(princomp_bogota_1)
```
```{r}
# Unrotated components with 6 factors
princomp_bogota_1$loadings[, 1:6]
```
```{r}
biplot(princomp_bogota_1)
```

```{r}
survey_bogota_2 <- subset(motivation_hackid, id == 2)
survey_bogota_2
```

```{r}
princomp_bogota_2 <- princomp(survey_bogota_2[1:13], scores=TRUE, cor=TRUE)
summary(princomp_bogota_2)
```
```{r}
# Unrotated components with 6 factors
princomp_bogota_2$loadings[, 1:6]
```
```{r}
biplot(princomp_bogota_2)
```

```{r}
survey_bogota_3 <- subset(motivation_hackid, id == 3)
survey_bogota_3
```
```{r}
princomp_bogota_3 <- princomp(survey_bogota_3[1:13], scores=TRUE, cor=TRUE)
summary(princomp_bogota_3)
```

```{r}
# Unrotated components with 6 factors
princomp_bogota_3$loadings[, 1:6]
```
```{r}
biplot(princomp_bogota_3)
```

```{r}
survey_bogota_0[1:13]
```

```{r}
# Varimax Rotated Principal Components
# retaining 6 components
library(psych)
fit <- principal(survey_bogota_0[1:13], nfactors=6, rotate="varimax")
fit # print results
```

```{r}
library(psych)
fit <- principal(survey_bogota_1[1:13], nfactors=6, rotate="varimax")
fit # print results
```

```{r}
library(psych)
fit <- principal(survey_bogota_2[1:13], nfactors=6, rotate="varimax")
fit # print results
```

```{r}
library(psych)
fit <- principal(survey_bogota_3[1:13], nfactors=6, rotate="varimax")
fit # print results
```


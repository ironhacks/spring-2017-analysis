---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
# Loading required package: psych
require(psych)

# Loading required package: GPArotation
require(GPArotation)

library(lattice)
url <- "/Users/jialincheoh/Desktop/overall_scores.csv"
scores <- read.csv(url, header=TRUE)
scores

```


```{r}
mean(scores$improve.tech.15)
```




Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

```{r}
scores_df <- scores[c('improve.vis.15', 'improve.ur.15', 'improve.tech.15', 'improve.novel.15')]
scores_df
```
```{r}
lowerCor(scores_df)
```


```{r}
princomp_output <- princomp(scores_df, scores=TRUE, cor=TRUE)
summary(princomp_output)
```

```{r}
plot(princomp_output)
```

```{r}
biplot(princomp_output)
```

```{r}
princomp_output$loadings[, 1:2]
```

# Interpretation: 

> improve-vis-15 and improve-ur-15 heavily loaded on component 1 

> improve-tech-15 heavily loaded on component 2

```{r}
## Print the scores (projections)
## rotated or transformed dataset
fit_unrotated_matrix <- princomp_output$scores[, 1:2]
fit_unrotated_matrix
```

```{r}
prcomp_output <- prcomp(scores_df, center = TRUE, scale = TRUE)
prcomp_output
```

```{r}
scores.pca<-cbind(scores_df,prcomp_output$x[,1:2])
scores.pca
```
```{r}
prcomp_output$rotation[, 1:2]
```

```{r}
scores.pca
```

```{r}
survey
```

```{r}
scores.pca<-cbind(scores.pca,scores[c('Group')])
scores.pca
```
```{r}
unrotated_1 <- aov(PC1 ~ Group, data=scores.pca)
summary(unrotated_1)
```


```{r}
unrotated_2 <- aov(PC2 ~ Group, data=scores.pca)
summary(unrotated_2)
```

```{r}
scores.raw<-cbind(scores_df,scores[c('Group')])
scores.raw
```
```{r}
unrotated_1 <- aov(improve.vis.15 ~ Group, data=scores.raw)
summary(unrotated_1)
```

```{r}
unrotated_1 <- aov(improve.tech.15 ~ Group, data=scores.raw)
summary(unrotated_1)
```

```{r}
library(psych)
describeBy(scores.raw$improve.tech.15, scores.raw$Group)
```

```{r}
library(ggplot2)
ggplot(scores.raw,aes(y=improve.tech.15, x=Group, fill=Group))+
  stat_summary(fun.y="mean", geom="bar",position="dodge")+
  stat_summary(fun.data = mean_se, geom = "errorbar", position="dodge",width=.8)
```

```{r}
unrotated_1 <- aov(improve.ur.15 ~ Group, data=scores.raw)
summary(unrotated_1)
```

```{r}
unrotated_1 <- aov(improve.novel.15 ~ Group, data=scores.raw)
summary(unrotated_1)
```

```{r}
scores_bogota_0 <- subset(scores.raw, Group == 0)
scores_bogota_0
```
```{r}
scores_bogota_1 <- subset(scores.raw, Group == 1)
scores_bogota_1
```

```{r}
scores_bogota_2 <- subset(scores.raw, Group == 2)
scores_bogota_2
```

```{r}
scores_bogota_3 <- subset(scores.raw, Group == 3)
scores_bogota_3
```
```{r}
scores_df_0 <- scores_bogota_0[c('improve.vis.15', 'improve.ur.15', 'improve.tech.15', 'improve.novel.15')]
scores_df_0
```
```{r}
scores_df_1 <- scores_bogota_1[c('improve.vis.15', 'improve.ur.15', 'improve.tech.15', 'improve.novel.15')]
scores_df_1
```
```{r}
scores_df_2 <- scores_bogota_2[c('improve.vis.15', 'improve.ur.15', 'improve.tech.15', 'improve.novel.15')]
scores_df_2
```
```{r}
scores_df_3 <- scores_bogota_3[c('improve.vis.15', 'improve.ur.15', 'improve.tech.15', 'improve.novel.15')]
scores_df_3
```
```{r}
princomp_output_0 <- princomp(scores_df_0, scores=TRUE, cor=TRUE)
summary(princomp_output_0)
```

```{r}
princomp_output_0$loadings[, 1:2]
```

```{r}
princomp_output_1 <- princomp(scores_df_1, scores=TRUE, cor=TRUE)
summary(princomp_output_1)
```

```{r}
princomp_output_1$loadings[, 1:2]
```

```{r}
princomp_output_2 <- princomp(scores_df_2, scores=TRUE, cor=TRUE)
summary(princomp_output_2)
```

```{r}
princomp_output_2$loadings[, 1:2]
```

```{r}
princomp_output_3 <- princomp(scores_df_3, scores=TRUE, cor=TRUE)
summary(princomp_output_3)
```

```{r}
princomp_output_3$loadings[, 1:2]
```

```{r}
mean(scores_bogota_0$improve.novel.15)
```

```{r}
mean(scores_bogota_1$improve.novel.15)
```

```{r}
mean(scores_bogota_2$improve.novel.15)
```

```{r}
mean(scores_bogota_3$improve.novel.15)
```

```{r}
mean(scores_bogota_0$improve.vis.15)
```

```{r}
mean(scores_bogota_1$improve.vis.15)
```

```{r}
mean(scores_bogota_2$improve.vis.15)
```

```{r}
mean(scores_bogota_3$improve.vis.15)
```

```{r}
mean(scores_bogota_0$improve.ur.15)
```

```{r}
mean(scores_bogota_1$improve.ur.15)
```

```{r}
mean(scores_bogota_2$improve.ur.15)
```

```{r}
mean(scores_bogota_3$improve.ur.15)
```


# MANOVA 

```{r}
scores
```

```{r}
scores$performance <- ifelse(scores$Group==1, "Yes",
        ifelse(scores$Group==2, "No",
        ifelse(scores$Group==0, "No",
        ifelse(scores$Group==3, "Yes", NA))))

scores
```

```{r}
scores$solution <- ifelse(scores$Group==1, "No",
        ifelse(scores$Group==2, "Yes",
        ifelse(scores$Group==0, "No",
        ifelse(scores$Group==3, "Yes", NA))))

scores
```

```{r}
scores_manova <- scores[, c('performance', 'solution', 'improve.tech.15', 'improve.vis.15', 'improve.novel.15', 'improve.ur.15')]
scores_manova
```

```{r}
summary(scores_manova)
```

## outliers 

```{r}
cutoff = qchisq(1-.001, ncol(scores_manova[ , c(3: 6)]))

mahal = mahalanobis(scores_manova[, c(3: 6)], colMeans(scores_manova[ , c(3:6 )]), cov(scores_manova[ , c(3:6)]))
cutoff
ncol(scores_manova[, c(3: 6)])
summary(mahal < cutoff)
```

```{r}
# exclude outliers
nout = subset(scores_manova, mahal < cutoff)
nout
```
```{r}
scores_manova
```
```{r}
## additivity 
correl = cor(nout[ , c(3:6)], use = "pairwise.complete.obs")
symnum(correl)
correl
```
```{r}
# assumption set up 

random = rchisq(nrow(scores_manova), 7)
fake = lm(random~., data = scores_manova )
standardized = rstudent(fake)
fitted = scale(fake$fitted.values)

```

```{r}
## normality 
hist(standardized)
```

```{r}
## linearity 
qqnorm(standardized)
abline(0, 1)
```

```{r}
##homogeneity

plot(fitted, standardized)
abline(0, 0)
abline(v = 0)
```

```{r}
## levens's test 
library(car)
leveneTest(improve.tech.15 ~ performance*solution, 
           data = scores_manova, center = mean)
```
```{r}
leveneTest(improve.vis.15 ~ performance*solution, 
           data = scores_manova, center = mean)
```


```{r}
leveneTest(improve.novel.15 ~ performance*solution, 
           data = scores_manova, center = mean)
```



```{r}
leveneTest(improve.ur.15 ~ performance*solution, 
           data = scores_manova, center = mean)
```

```{r}
## run the manova 
DV = cbind(scores_manova$improve.tech.15, scores_manova$improve.ur.15, scores_manova$improve.vis.15, scores_manova$improve.novel.15)
View(DV)
output = lm(DV ~ performance*solution, data = scores_manova, contrasts = list(performance=contr.sum, solution=contr.sum))
manova_out = Manova(output, type='III')
summary(manova_out, multivariate = T)
```
## Interpretation: 

> Performance: F(4, 156) = 0.66, p = 0.62, eta squared = 0.017 

> Solution: F(4, 156) = 2.66, p = 0.035, eta squared = 0.064

> Interaction: F(4, 156) = 1.61, eta squared = 0.04 


```{r}
scores_manova$consecutive_numbers<-1:nrow(scores_manova)
scores_manova
```

```{r}
##run the anovas look at the significant effects only
library(ez)
ezANOVA(data = scores_manova,
        dv = improve.tech.15,
        wid = consecutive_numbers,
        between = .(performance, solution), 
        type = 3)

```

```{r}
library(ez)
ezANOVA(data = scores_manova,
        dv = improve.vis.15,
        wid = consecutive_numbers,
        between = .(performance, solution), 
        type = 3)
```

```{r}
library(ez)
ezANOVA(data = scores_manova,
        dv = improve.novel.15,
        wid = consecutive_numbers,
        between = .(performance, solution), 
        type = 3)
```

```{r}
library(ez)
ezANOVA(data = scores_manova,
        dv = improve.ur.15,
        wid = consecutive_numbers,
        between = .(performance, solution), 
        type = 3)
```

# Interpretation: 

> improve-tech-15 
1. Performance: F(1, 159) = 0.00014, p = 0.97, partial eta squared = 8.909e-06
2. Solution: F(1,159) = 5.296, p = 0.0227, partial eta squared = 3.223e-02

> improve-vis-15 
1. Performance: F(1, 159) = 1.162, p = 0.283, partial eta squared = 0.00725
2. Solution: F(1, 159) = 0.004, p = 0.948, partial eta squared = 0.0000264

> improve-novel-15 
1. Performance: F(1, 159) = 0.0553, p = 0.814, partial eta squared = 3.476e-04
2. Solution: F(1, 159) = 0.014, p = 0.905, partial eta squared = 8.993892e-05

```{r}
tapply(scores_manova$improve.tech.15, list(scores_manova$performance), mean)

```

```{r}
library(gridExtra)
p1 <- ggplot(scores_manova, aes(x = plant_var, y = height, fill = plant_var)) + geom_boxplot(outlier.shape = NA) + geom_jitter(width = 0.2) + theme(legend.position="top")
p2 <- ggplot(df, aes(x = plant_var, y = canopy_vol, fill = plant_var)) + geom_boxplot(outlier.shape = NA) + geom_jitter(width = 0.2) + theme(legend.position="top")
grid.arrange(p1, p2, ncol=2)
```

```{r}
scores_manova
```


```{r}
dep_vars <- cbind(scores$improve.tech.15, scores$improve.ur.15, scores$improve.novel.15, scores$improve.vis.15)
fit <- manova(dep_vars ~ Group, data = scores)
summary(fit)
                                          

```

```{r}
library(effectsize)
effectsize::eta_squared(fit)
```
```{r}
library(MASS)
post_hoc <- lda(scores$Group ~ dep_vars, CV=F)
post_hoc


```
```{r}
scores[, "Group"]
```


```{r}
plot_lda <- data.frame(scores[, "Group"], lda = predict(post_hoc)$x)
ggplot(plot_lda) + geom_point(aes(x = lda.LD1, y = lda.LD2, colour = scores$Group), size = 4)
```








